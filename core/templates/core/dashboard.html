{% extends 'core/base.html' %}
{% block title %}Dashboard{% endblock %}

{% block content %}
  <h1 class="mb-4">Dashboard de Vagas</h1>

  <!-- 1. Cards de Métrica -->
  <div class="row mb-4">
    <!-- Vagas Abertas -->
    <div class="col-md-3">
      <div class="card text-white bg-primary mb-2">
        <div class="card-body">
          <h5 class="card-title">Vagas Abertas</h5>
          <p class="card-text display-6">{{ abertas }}</p>
        </div>
      </div>
    </div>
    <!-- Vagas Fechadas -->
    <div class="col-md-3">
      <div class="card text-white bg-secondary mb-2">
        <div class="card-body">
          <h5 class="card-title">Vagas Fechadas</h5>
          <p class="card-text display-6">{{ fechadas }}</p>
        </div>
      </div>
    </div>
    <!-- Idade Média -->
    <div class="col-md-3">
      <div class="card text-white bg-success mb-2">
        <div class="card-body">
          <h5 class="card-title">Idade Média</h5>
          <p class="card-text display-6">{{ media_idade }} anos</p>
        </div>
      </div>
    </div>
    <!-- Setor Mais Ativo -->
    <div class="col-md-3">
      <div class="card text-white bg-info mb-2">
        <div class="card-body">
          <h5 class="card-title">Setor Mais Ativo</h5>
          <p class="card-text display-6">{{ setor_mais_vagas }}</p>
        </div>
      </div>
    </div>
  </div>

<!-- Tabela de Candidatos por Vaga -->
<div class="table-responsive mb-5">
  <table class="table table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th>Vaga</th>
        <th>Candidatos</th>
      </tr>
    </thead>
    <tbody>
      {% for item in dados_vagas %}
        <tr>
          <td>{{ item.vaga }}</td>
          <td>{{ item.candidatos }}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="2" class="text-center">Nenhuma vaga cadastrada.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
>

  <!-- 3. Gráfico de Barras -->
  <div
    id="chart-container"
    data-labels='{{ chart_labels_json|escapejs }}'
    data-values='{{ chart_values_json|escapejs }}'>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const container = document.getElementById('chart-container');
    const labels    = JSON.parse(container.dataset.labels);
    const values    = JSON.parse(container.dataset.values);
    const canvas    = document.createElement('canvas');
    container.appendChild(canvas);
    const ctx       = canvas.getContext('2d');

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Candidatos por Vaga',
          data: values,
          backgroundColor: 'rgba(0,123,255,0.5)',
          borderColor:     'rgba(0,123,255,1)',
          borderWidth: 1
        }]
      },
      options: {
        scales: { y: { beginAtZero: true } }
      }
    });
  </script>
{% endblock %}
